{"version":3,"sources":["webpack:///./src/views/login/index.vue?2b81","webpack:///./src/views/login/index.vue?c914","webpack:///./src/utils/tools.js","webpack:///./src/utils/validator.js","webpack:///./src/views/login/rules/index.js","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?d983","webpack:///./src/views/login/index.vue","webpack:///./src/http/user.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","fromRules","mobileRule","model","value","user","callback","$$v","$set","expression","codeRule","scopedSlots","_u","key","fn","handleSendCode","_v","proxy","handleLogin","_m","staticRenderFns","countDown","e","count","target","disabled","f","innerText","clearInterval","getCodeInter","setInterval","mobileReg","mobileValidator","val","test","required","message","validator","name","data","mobile","code","methods","component","hanldeLoginApi","request","method","url","handleSendMobileMessageApi","userInfoApi","getUserTabsListApi","getAllChannelsApi","addUserChannelApi","deleteUserChannelApi","followAutorApi","cancelFollowAutorApi","getUserProfitApi"],"mappings":"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","file":"js/chunk-755754f8.6aeee351.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=0663875e&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login\"},[_c('van-nav-bar',{attrs:{\"title\":\"注册 / 登录\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"loginForm\",attrs:{\"validate-first\":\"\",\"show-error\":false,\"show-error-message\":false}},[_c('van-field',{attrs:{\"name\":\"mobile\",\"left-icon\":\"shouji iconfont\",\"icon-prefix\":\"toutiao\",\"placeholder\":\"请输入手机号\",\"rules\":_vm.fromRules.mobileRule},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"name\":\"code\",\"left-icon\":\"yanzhengma iconfont\",\"icon-prefix\":\"toutiao\",\"placeholder\":\"请输入验证码\",\"rules\":_vm.fromRules.codeRule},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [_c('van-button',{staticClass:\"send-btn\",attrs:{\"size\":\"mini\",\"type\":\"default\",\"round\":\"\"},on:{\"click\":_vm.handleSendCode}},[_vm._v(\"发送验证码\")])]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}})],1),_c('div',{staticClass:\"login-btn-wrapper\"},[_c('van-button',{attrs:{\"type\":\"info\",\"block\":\"\"},on:{\"click\":_vm.handleLogin}},[_vm._v(\"登录\")])],1),_vm._m(0)],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"account\"},[_c('p',[_vm._v(\"测试账号 / 万能验证码\")]),_c('p',[_vm._v(\"13911111111 / 246810\")]),_c('p',[_vm._v(\"13611111111 / 246810\")]),_c('p',[_vm._v(\"13922222222 / 246810\")])])}]\n\nexport { render, staticRenderFns }","/**\n * 获取验证码倒计时函数\n *\n * @param {Object} e  事件对象\n */\n\nexport const countDown = (e) => {\n  let count = 60\n  e.target.disabled = true\n  const f = () => {\n    if (e.target.innerText === '0 s') {\n      count = 60\n      e.target.innerText = '发送验证码'\n      e.target.disabled = false\n      clearInterval(getCodeInter)\n      return false\n    }\n    count--\n    e.target.innerText = count + ' s'\n  }\n  f()\n  const getCodeInter = setInterval(f, 1000)\n}\n","// 手机校验正则\nconst mobileReg = /^1[3456789]\\d{9}$/\n\nexport const mobileValidator = (val) => {\n  return mobileReg.test(val)\n}\n","import { mobileValidator } from '@/utils/validator.js'\n\n// 登录手机校验\nconst mobileRule = [\n  // 必填校验\n  { required: true, message: '请输入手机号' },\n  // 函数自定义校验\n  { validator: mobileValidator, message: '手机号格式有误' }\n]\n\n// 验证码必填校验\nconst codeRule = [\n  // 必填校验\n  { required: true, message: '请输入验证码' }\n]\n\nexport default {\n  mobileRule,\n  codeRule\n}\n","<template>\n  <div class=\"login\">\n    <van-nav-bar\n      title=\"注册 / 登录\"\n      left-arrow\n      @click-left=\"$router.back()\"\n    />\n    <!-- 登录表单 -->\n    <van-form\n      validate-first\n      ref=\"loginForm\"\n      :show-error=\"false\"\n      :show-error-message=\"false\"\n    >\n      <van-field\n        name=\"mobile\"\n        v-model=\"user.mobile\"\n        left-icon=\"shouji iconfont\"\n        icon-prefix=\"toutiao\"\n        placeholder=\"请输入手机号\"\n        :rules=\"fromRules.mobileRule\"\n      >\n      </van-field>\n      <van-field\n        name=\"code\"\n        v-model=\"user.code\"\n        left-icon=\"yanzhengma iconfont\"\n        icon-prefix=\"toutiao\"\n        placeholder=\"请输入验证码\"\n        :rules=\"fromRules.codeRule\"\n      >\n        <template #button>\n          <van-button class=\"send-btn\" size=\"mini\" type=\"default\" round @click=\"handleSendCode\">发送验证码</van-button>\n        </template>\n      </van-field>\n    </van-form>\n    <!-- 登录按钮 -->\n    <div class=\"login-btn-wrapper\">\n      <van-button type=\"info\" block @click=\"handleLogin\">登录</van-button>\n    </div>\n    <div class=\"account\">\n      <p>测试账号 / 万能验证码</p>\n      <p>13911111111 / 246810</p>\n      <p>13611111111 / 246810</p>\n      <p>13922222222 / 246810</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { hanldeLoginApi, handleSendMobileMessageApi } from '@/http/user.js'\nimport { countDown } from '@/utils/tools.js'\nimport fromRules from './rules/index'\nexport default {\n  name: 'login',\n  data () {\n    return {\n      user: {\n        mobile: '',\n        code: ''\n      },\n      fromRules\n    }\n  },\n  methods: {\n    // 请求登录\n    async handleLogin () {\n      try {\n        // 表单验证\n        await this.$refs.loginForm.validate()\n\n        this.$toast.loading({\n          message: '登录中...',\n          forbidClick: true,\n          duration: 0\n        })\n        try {\n          const { data } = await hanldeLoginApi(this.user)\n          console.log('请求返回', data)\n\n          this.$toast.success('登陆成功')\n\n          // 登陆成功后 清除页面缓存\n          this.$store.commit('removeAcaheView', 'layout')\n\n          // vuex存储登录接口获取的token数据\n          this.$store.commit('setUser', data.data)\n          // 登录成功 返回上一个页面  这种方式不太好 比如你从外部一个网站直接进入登录页 那么登录成功还是会跳转到这个外部网站\n          // this.$router.back()\n          this.$router.push(this.$route.query.redirect || '/')\n        } catch (err) {\n          console.log('登陆失败', err)\n          this.$toast.fail('登陆失败 手机号或验证码错误')\n        }\n      } catch (err) {\n        // 自定义校验失败时的弹窗提示\n        if (err[0]) {\n          console.log(err, 'err')\n          const failMsg = err[0].message\n          this.$toast({\n            message: failMsg,\n            position: 'top'\n          })\n        }\n      }\n    },\n    // 发送验证码\n    async handleSendCode (e) {\n      // 需要校验手机号这单个表单\n      try {\n        await this.$refs.loginForm.validate('mobile')\n        // 验证码倒计时函数\n        countDown(e)\n        // 调后台接口发送验证码\n        try {\n          const res = await handleSendMobileMessageApi(this.user.mobile)\n          console.log('验证码返回', res)\n        } catch (err) {\n          this.$toast({\n            message: '发送验证码失败，请稍后再试',\n            position: 'top'\n          })\n        }\n      } catch (err) {\n        console.log(err, 'err')\n        const failMsg = err.message\n        this.$toast({\n          message: failMsg,\n          position: 'top'\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n  .login {\n    .van-field__button {\n      border: 1px solid pink;\n      .send-btn {\n        width: 75px;\n        height: 24px;\n        background-color: #ededed;\n        .van-button__text {\n          color: #666;\n          font-size: 11px;\n        }\n      }\n    }\n    .login-btn-wrapper {\n      padding: 25px 14px 0;\n      .van-button {\n        border: 0;\n        .van-button__text {\n          font-size: 15px;\n        }\n      }\n    }\n    .account  {\n      font-size: 16px;\n      color: #ccc;\n      line-height: 25px;\n      text-align: center;\n      margin-top: 50px;\n    }\n  }\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=0663875e&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0663875e&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0663875e\",\n  null\n  \n)\n\nexport default component.exports","/**\n * 用户相关的请求模块\n */\nimport request from '@/utils/request'\n\n/**\n * 登录注册\n */\nexport const hanldeLoginApi = (data) => {\n  return request({\n    method: 'POST',\n    url: '/app/v1_0/authorizations',\n    data\n  })\n}\n\n/**\n * 发送手机验证码\n */\nexport const handleSendMobileMessageApi = (data) => {\n  return request({\n    method: 'GET',\n    url: `/app/v1_0/sms/codes/${data}`\n  })\n}\n\n/**\n * 获取用户自己的信息\n */\n\nexport const userInfoApi = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user'\n  })\n}\n\n/**\n * 获取用户首页头部标签内容\n */\n\nexport const getUserTabsListApi = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user/channels'\n  })\n}\n\n/**\n *\n * 获取所有的频道\n */\n\nexport const getAllChannelsApi = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/channels'\n  })\n}\n\n/**\n * 新增用户频道\n *\n */\n\nexport const addUserChannelApi = data => {\n  return request({\n    method: 'PATCH',\n    url: '/app/v1_0/user/channels',\n    data\n  })\n}\n\n/**\n * 删除指定的频道\n */\nexport const deleteUserChannelApi = data => {\n  return request({\n    method: 'DELETE',\n    url: `/app/v1_0/user/channels/${data}`\n  })\n}\n\n/**\n * 关注用户\n */\nexport const followAutorApi = data => {\n  return request({\n    method: 'POST',\n    url: '/app/v1_0/user/followings',\n    data\n  })\n}\n\n/**\n * 取消关注用户\n */\n\nexport const cancelFollowAutorApi = target => {\n  return request({\n    method: 'DELETE',\n    url: `/app/v1_0/user/followings/${target}`\n  })\n}\n\n/**\n * 获取用户个人信息\n */\nexport const getUserProfitApi = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user/profile'\n  })\n}\n"],"sourceRoot":""}