{"version":3,"sources":["webpack:///./src/views/login/index.vue?2b81","webpack:///./src/views/login/index.vue?4877","webpack:///./src/utils/tools.js","webpack:///./src/utils/validator.js","webpack:///./src/views/login/rules/index.js","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?d983","webpack:///./src/views/login/index.vue","webpack:///./src/http/user.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","fromRules","mobileRule","model","value","user","callback","$$v","$set","expression","codeRule","scopedSlots","_u","key","fn","handleSendCode","_v","proxy","handleLogin","_m","staticRenderFns","countDown","e","count","target","disabled","f","innerText","clearInterval","getCodeInter","setInterval","mobileReg","mobileValidator","val","test","required","message","validator","name","data","mobile","code","methods","component","hanldeLoginApi","request","method","url","handleSendMobileMessageApi","userInfoApi","getUserTabsListApi","getAllChannelsApi","addUserChannelApi","deleteUserChannelApi","followAutorApi","cancelFollowAutorApi","getUserProfitApi","editUserProfitApi","q"],"mappings":"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","file":"js/chunk-755754f8.19a7d425.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=0663875e&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login\"},[_c('van-nav-bar',{attrs:{\"title\":\"注册 / 登录\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"loginForm\",attrs:{\"validate-first\":\"\",\"show-error\":false,\"show-error-message\":false}},[_c('van-field',{attrs:{\"name\":\"mobile\",\"left-icon\":\"shouji iconfont\",\"icon-prefix\":\"toutiao\",\"placeholder\":\"请输入手机号\",\"rules\":_vm.fromRules.mobileRule},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"name\":\"code\",\"left-icon\":\"yanzhengma iconfont\",\"icon-prefix\":\"toutiao\",\"placeholder\":\"请输入验证码\",\"rules\":_vm.fromRules.codeRule},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [_c('van-button',{staticClass:\"send-btn\",attrs:{\"size\":\"mini\",\"type\":\"default\",\"round\":\"\"},on:{\"click\":_vm.handleSendCode}},[_vm._v(\"发送验证码\")])]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}})],1),_c('div',{staticClass:\"login-btn-wrapper\"},[_c('van-button',{attrs:{\"type\":\"info\",\"block\":\"\"},on:{\"click\":_vm.handleLogin}},[_vm._v(\"登录\")])],1),_vm._m(0)],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"account\"},[_c('p',[_vm._v(\"测试账号 / 万能验证码\")]),_c('p',[_vm._v(\"13911111111 / 246810\")]),_c('p',[_vm._v(\"13611111111 / 246810\")]),_c('p',[_vm._v(\"13922222222 / 246810\")])])}]\n\nexport { render, staticRenderFns }","/**\r\n * 获取验证码倒计时函数\r\n *\r\n * @param {Object} e  事件对象\r\n */\r\n\r\nexport const countDown = (e) => {\r\n  let count = 60\r\n  e.target.disabled = true\r\n  const f = () => {\r\n    if (e.target.innerText === '0 s') {\r\n      count = 60\r\n      e.target.innerText = '发送验证码'\r\n      e.target.disabled = false\r\n      clearInterval(getCodeInter)\r\n      return false\r\n    }\r\n    count--\r\n    e.target.innerText = count + ' s'\r\n  }\r\n  f()\r\n  const getCodeInter = setInterval(f, 1000)\r\n}\r\n","// 手机校验正则\r\nconst mobileReg = /^1[3456789]\\d{9}$/\r\n\r\nexport const mobileValidator = (val) => {\r\n  return mobileReg.test(val)\r\n}\r\n","import { mobileValidator } from '@/utils/validator.js'\r\n\r\n// 登录手机校验\r\nconst mobileRule = [\r\n  // 必填校验\r\n  { required: true, message: '请输入手机号' },\r\n  // 函数自定义校验\r\n  { validator: mobileValidator, message: '手机号格式有误' }\r\n]\r\n\r\n// 验证码必填校验\r\nconst codeRule = [\r\n  // 必填校验\r\n  { required: true, message: '请输入验证码' }\r\n]\r\n\r\nexport default {\r\n  mobileRule,\r\n  codeRule\r\n}\r\n","<template>\r\n  <div class=\"login\">\r\n    <van-nav-bar\r\n      title=\"注册 / 登录\"\r\n      left-arrow\r\n      @click-left=\"$router.back()\"\r\n    />\r\n    <!-- 登录表单 -->\r\n    <van-form\r\n      validate-first\r\n      ref=\"loginForm\"\r\n      :show-error=\"false\"\r\n      :show-error-message=\"false\"\r\n    >\r\n      <van-field\r\n        name=\"mobile\"\r\n        v-model=\"user.mobile\"\r\n        left-icon=\"shouji iconfont\"\r\n        icon-prefix=\"toutiao\"\r\n        placeholder=\"请输入手机号\"\r\n        :rules=\"fromRules.mobileRule\"\r\n      >\r\n      </van-field>\r\n      <van-field\r\n        name=\"code\"\r\n        v-model=\"user.code\"\r\n        left-icon=\"yanzhengma iconfont\"\r\n        icon-prefix=\"toutiao\"\r\n        placeholder=\"请输入验证码\"\r\n        :rules=\"fromRules.codeRule\"\r\n      >\r\n        <template #button>\r\n          <van-button class=\"send-btn\" size=\"mini\" type=\"default\" round @click=\"handleSendCode\">发送验证码</van-button>\r\n        </template>\r\n      </van-field>\r\n    </van-form>\r\n    <!-- 登录按钮 -->\r\n    <div class=\"login-btn-wrapper\">\r\n      <van-button type=\"info\" block @click=\"handleLogin\">登录</van-button>\r\n    </div>\r\n    <div class=\"account\">\r\n      <p>测试账号 / 万能验证码</p>\r\n      <p>13911111111 / 246810</p>\r\n      <p>13611111111 / 246810</p>\r\n      <p>13922222222 / 246810</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { hanldeLoginApi, handleSendMobileMessageApi } from '@/http/user.js'\r\nimport { countDown } from '@/utils/tools.js'\r\nimport fromRules from './rules/index'\r\nexport default {\r\n  name: 'login',\r\n  data () {\r\n    return {\r\n      user: {\r\n        mobile: '',\r\n        code: ''\r\n      },\r\n      fromRules\r\n    }\r\n  },\r\n  methods: {\r\n    // 请求登录\r\n    async handleLogin () {\r\n      try {\r\n        // 表单验证\r\n        await this.$refs.loginForm.validate()\r\n\r\n        this.$toast.loading({\r\n          message: '登录中...',\r\n          forbidClick: true,\r\n          duration: 0\r\n        })\r\n        try {\r\n          const { data } = await hanldeLoginApi(this.user)\r\n          console.log('请求返回', data)\r\n\r\n          this.$toast.success('登陆成功')\r\n\r\n          // 登陆成功后 清除页面缓存\r\n          this.$store.commit('removeAcaheView', 'layout')\r\n\r\n          // vuex存储登录接口获取的token数据\r\n          this.$store.commit('setUser', data.data)\r\n          // 登录成功 返回上一个页面  这种方式不太好 比如你从外部一个网站直接进入登录页 那么登录成功还是会跳转到这个外部网站\r\n          // this.$router.back()\r\n          this.$router.push(this.$route.query.redirect || '/')\r\n        } catch (err) {\r\n          console.log('登陆失败', err)\r\n          this.$toast.fail('登陆失败 手机号或验证码错误')\r\n        }\r\n      } catch (err) {\r\n        // 自定义校验失败时的弹窗提示\r\n        if (err[0]) {\r\n          console.log(err, 'err')\r\n          const failMsg = err[0].message\r\n          this.$toast({\r\n            message: failMsg,\r\n            position: 'top'\r\n          })\r\n        }\r\n      }\r\n    },\r\n    // 发送验证码\r\n    async handleSendCode (e) {\r\n      // 需要校验手机号这单个表单\r\n      try {\r\n        await this.$refs.loginForm.validate('mobile')\r\n        // 验证码倒计时函数\r\n        countDown(e)\r\n        // 调后台接口发送验证码\r\n        try {\r\n          const res = await handleSendMobileMessageApi(this.user.mobile)\r\n          console.log('验证码返回', res)\r\n        } catch (err) {\r\n          this.$toast({\r\n            message: '发送验证码失败，请稍后再试',\r\n            position: 'top'\r\n          })\r\n        }\r\n      } catch (err) {\r\n        console.log(err, 'err')\r\n        const failMsg = err.message\r\n        this.$toast({\r\n          message: failMsg,\r\n          position: 'top'\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .login {\r\n    .van-field__button {\r\n      border: 1px solid pink;\r\n      .send-btn {\r\n        width: 75px;\r\n        height: 24px;\r\n        background-color: #ededed;\r\n        .van-button__text {\r\n          color: #666;\r\n          font-size: 11px;\r\n        }\r\n      }\r\n    }\r\n    .login-btn-wrapper {\r\n      padding: 25px 14px 0;\r\n      .van-button {\r\n        border: 0;\r\n        .van-button__text {\r\n          font-size: 15px;\r\n        }\r\n      }\r\n    }\r\n    .account  {\r\n      font-size: 16px;\r\n      color: #ccc;\r\n      line-height: 25px;\r\n      text-align: center;\r\n      margin-top: 50px;\r\n    }\r\n  }\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=0663875e&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0663875e&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0663875e\",\n  null\n  \n)\n\nexport default component.exports","/**\r\n * 用户相关的请求模块\r\n */\r\nimport request from '@/utils/request'\r\n\r\n/**\r\n * 登录注册\r\n */\r\nexport const hanldeLoginApi = (data) => {\r\n  return request({\r\n    method: 'POST',\r\n    url: '/app/v1_0/authorizations',\r\n    data\r\n  })\r\n}\r\n\r\n/**\r\n * 发送手机验证码\r\n */\r\nexport const handleSendMobileMessageApi = (data) => {\r\n  return request({\r\n    method: 'GET',\r\n    url: `/app/v1_0/sms/codes/${data}`\r\n  })\r\n}\r\n\r\n/**\r\n * 获取用户自己的信息\r\n */\r\n\r\nexport const userInfoApi = () => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/user'\r\n  })\r\n}\r\n\r\n/**\r\n * 获取用户首页头部标签内容\r\n */\r\n\r\nexport const getUserTabsListApi = () => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/user/channels'\r\n  })\r\n}\r\n\r\n/**\r\n *\r\n * 获取所有的频道\r\n */\r\n\r\nexport const getAllChannelsApi = () => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/channels'\r\n  })\r\n}\r\n\r\n/**\r\n * 新增用户频道\r\n *\r\n */\r\n\r\nexport const addUserChannelApi = data => {\r\n  return request({\r\n    method: 'PATCH',\r\n    url: '/app/v1_0/user/channels',\r\n    data\r\n  })\r\n}\r\n\r\n/**\r\n * 删除指定的频道\r\n */\r\nexport const deleteUserChannelApi = data => {\r\n  return request({\r\n    method: 'DELETE',\r\n    url: `/app/v1_0/user/channels/${data}`\r\n  })\r\n}\r\n\r\n/**\r\n * 关注用户\r\n */\r\nexport const followAutorApi = data => {\r\n  return request({\r\n    method: 'POST',\r\n    url: '/app/v1_0/user/followings',\r\n    data\r\n  })\r\n}\r\n\r\n/**\r\n * 取消关注用户\r\n */\r\n\r\nexport const cancelFollowAutorApi = target => {\r\n  return request({\r\n    method: 'DELETE',\r\n    url: `/app/v1_0/user/followings/${target}`\r\n  })\r\n}\r\n\r\n/**\r\n * 获取用户个人信息\r\n */\r\nexport const getUserProfitApi = () => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/user/profile'\r\n  })\r\n}\r\n\r\n/**\r\n * 编辑个人信息\r\n */\r\n\r\nexport const editUserProfitApi = (q) => {\r\n  return request({\r\n    method: 'PATCH',\r\n    url: '/app/v1_0/user/profile',\r\n    data: q\r\n  })\r\n}\r\n"],"sourceRoot":""}